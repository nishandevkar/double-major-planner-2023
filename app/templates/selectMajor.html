{% extends "base.html" %}

{% block content %}

<!-- Select Major Area -->
<div class="major-container container overflow-hidden text-center">

<!-- Title of the Page -->
<div class="major-title h1 mb-5 mt-3">Select A Major</div>
<div class="search-bar-container container">


    <!-- Search area -->
    <form class="form-inline my-2">
        <div class="input-group">
            <input class="form-control flex-fill" type="text" placeholder="Search" aria-label="Search">
            <div class="input-group-append">
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </div>
    </form>
</div>

<form id="major-selection-form">

<!-- First row of Majors -->
<!--        <div class="major-selection-row row mb-5">-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--        </div>-->


<!--&lt;!&ndash; Second row of Majors &ndash;&gt;-->
<!--        <div class="major-selection-row row">-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--            <div class="col">-->
<!--                <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button">Major</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<div class="major-selection-row row">
    {% for major in majors %}
    <div class="col">
        <button class="btn btn-lg p-4 btn-outline-primary" data-bs-toggle="button" data-major="{{ major }}">
            {{ major }}
        </button>
    </div>
    {% endfor %}
</div>

<!-- Confirmation area -->
    <div class="container mt-5 d-flex justify-content-between border rounded-4 p-3">
        <p class="h5" id="selected-majors-paragraph"> Selected Majors: </p>
        <div class="confirm-button btn btn-primary btn-lg" onclick="sendSelectedMajors()"> Confirm</div>
    </div>
</form>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
<script>
    const selectedMajors = [];
// Function to handle major button click events
function handleMajorButtonClick(major) {
    // Check if the selected major already exists in the array
    console.log(major);
    const index = selectedMajors.indexOf(major);

    if (index === -1) {
        // If the major is not selected, add it to the selectedMajors array
        selectedMajors.push(major);
        // Apply a visual style to indicate the selected state
        document.querySelector(`[data-major="${major}"]`).classList.add('selected');
    } else {
        // If the major is already selected, remove it from the selectedMajors array
        selectedMajors.splice(index, 1);
        // Remove the visual style
        document.querySelector(`[data-major="${major}"]`).classList.remove('selected');
    }

    // Update the displayed selected majors
    updateSelectedMajors();
}

// Add click event listeners to the major buttons
document.querySelectorAll('.btn-outline-primary').forEach(button => {
    button.addEventListener('click', function () {
        const major = this.dataset.major;
        handleMajorButtonClick(major);
    });
});

// Function to update the displayed selected majors
function updateSelectedMajors() {
    const selectedMajorsParagraph = document.getElementById('selected-majors-paragraph');
    // Update the text content for the selected majors
    selectedMajorsParagraph.textContent = `Selected Majors:  ${selectedMajors.join(', ')}`;
}

// Function to send selected majors to the backend and update the displayed selected majors
function sendSelectedMajors() {
    if (selectedMajors.length === 2) {
        // Create a data object to send to the Flask backend with a POST request
        const data = { 'selected_majors': selectedMajors };

        // Send an AJAX POST request to the Flask route
        fetch('/submit_majors', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data.message);
            // Update the displayed selected majors
            updateSelectedMajors();
            // Handle the response as needed
        })
        .catch(error => {
            console.error('Error:', error);
        });
    } else {
        console.log('Selected Majors:', selectedMajors); // Output the selected majors to the console
        alert('Please select two majors.');
    }
}

</script>

{% endblock %}
