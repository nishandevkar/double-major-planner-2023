{% extends "base.html" %}

{% block content %}

<div class="contents">
    <div class="card">
        <!-- Select Major Area -->
        <div class="major-container container overflow-hidden text-center">

        <!-- Title of the Page -->
        <div class="major-title h1 mb-5 mt-3">Select Majors</div>
        <div class="search-bar-container container">


            <!-- Search area -->
            <form class="form-inline my-2 mb-md-3">
                <div class="input-group">
                    <input class="form-control flex-fill" type="text" placeholder="Search" aria-label="Search">
                    <div class="input-group-append">
                        <button class="btn major-search" type="submit">Search</button>
                    </div>
                </div>
            </form>
        </div>

        <form id="major-selection-form">


        <div class="major-selection-row row">
            {% for major in majors %}
            <div class="col">
                <button class="btn majors mb-md-5 fs-6 btn-lg p-2" data-bs-toggle="button" data-major="{{ major }}">
                    {{ major }}
                </button>
            </div>
            {% endfor %}
        </div>


<!-- Confirmation area -->
        <div class="container mt-5 d-flex justify-content-between border rounded-4 p-3">
            <p class="h5" id="selected-majors-paragraph"> Selected Majors: </p>
            <div class="confirm-button btn btn-primary btn-lg" onclick="sendSelectedMajors()"> Confirm</div>
        </div>
        </form>
</div>
</div>

<script>
    const selectedMajors = [];
// Function to handle major button click events
function handleMajorButtonClick(major) {
    // Check if the selected major already exists in the array
    console.log(major);
    const index = selectedMajors.indexOf(major);

    if (index === -1) {
        // If the major is not selected, add it to the selectedMajors array
        selectedMajors.push(major);
        // Apply a visual style to indicate the selected state
        document.querySelector(`[data-major="${major}"]`).classList.add('selected');
    } else {
        // If the major is already selected, remove it from the selectedMajors array
        selectedMajors.splice(index, 1);
        // Remove the visual style
        document.querySelector(`[data-major="${major}"]`).classList.remove('selected');
    }

    // Update the displayed selected majors
    updateSelectedMajors();
}

// Add click event listeners to the major buttons
document.querySelectorAll('.majors').forEach(button => {
    button.addEventListener('click', function () {
        const major = this.dataset.major;
        handleMajorButtonClick(major);
    });
});

// Function to update the displayed selected majors
function updateSelectedMajors() {
    const selectedMajorsParagraph = document.getElementById('selected-majors-paragraph');
    // Update the text content for the selected majors
    selectedMajorsParagraph.textContent = `Selected Majors:  ${selectedMajors.join(', ')}`;
}

// Function to send selected majors to the backend and update the displayed selected majors
function sendSelectedMajors() {
    if (selectedMajors.length === 2) {
        // Create a data object to send to the Flask backend with a POST request
        const data = { 'selected_majors': selectedMajors };

        // Send an AJAX POST request to the Flask route
        fetch('/submit_majors', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data.message);
            // Update the displayed selected majors
            updateSelectedMajors();
            // Handle the response as needed
        })
        .catch(error => {
            console.error('Error:', error);
        });
    } else {
        console.log('Selected Majors:', selectedMajors); // Output the selected majors to the console
        alert('Please select two majors.');
    }
}

</script>

{% endblock %}
